{"ast":null,"code":"import _classCallCheck from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _get from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport { Factory } from '../Factory.js';\nimport { Shape } from '../Shape.js';\nimport { Animation } from '../Animation.js';\nimport { getNumberValidator } from '../Validators.js';\nimport { _registerNode } from '../Global.js';\nexport var Sprite = /*#__PURE__*/function (_Shape) {\n  _inherits(Sprite, _Shape);\n\n  var _super = _createSuper(Sprite);\n\n  function Sprite(config) {\n    var _this;\n\n    _classCallCheck(this, Sprite);\n\n    _this = _super.call(this, config);\n    _this._updated = true;\n    _this.anim = new Animation(function () {\n      var updated = _this._updated;\n      _this._updated = false;\n      return updated;\n    });\n\n    _this.on('animationChange.konva', function () {\n      this.frameIndex(0);\n    });\n\n    _this.on('frameIndexChange.konva', function () {\n      this._updated = true;\n    });\n\n    _this.on('frameRateChange.konva', function () {\n      if (!this.anim.isRunning()) {\n        return;\n      }\n\n      clearInterval(this.interval);\n\n      this._setInterval();\n    });\n\n    return _this;\n  }\n\n  _createClass(Sprite, [{\n    key: \"_sceneFunc\",\n    value: function _sceneFunc(context) {\n      var anim = this.animation(),\n          index = this.frameIndex(),\n          ix4 = index * 4,\n          set = this.animations()[anim],\n          offsets = this.frameOffsets(),\n          x = set[ix4 + 0],\n          y = set[ix4 + 1],\n          width = set[ix4 + 2],\n          height = set[ix4 + 3],\n          image = this.image();\n\n      if (this.hasFill() || this.hasStroke()) {\n        context.beginPath();\n        context.rect(0, 0, width, height);\n        context.closePath();\n        context.fillStrokeShape(this);\n      }\n\n      if (image) {\n        if (offsets) {\n          var offset = offsets[anim],\n              ix2 = index * 2;\n          context.drawImage(image, x, y, width, height, offset[ix2 + 0], offset[ix2 + 1], width, height);\n        } else {\n          context.drawImage(image, x, y, width, height, 0, 0, width, height);\n        }\n      }\n    }\n  }, {\n    key: \"_hitFunc\",\n    value: function _hitFunc(context) {\n      var anim = this.animation(),\n          index = this.frameIndex(),\n          ix4 = index * 4,\n          set = this.animations()[anim],\n          offsets = this.frameOffsets(),\n          width = set[ix4 + 2],\n          height = set[ix4 + 3];\n      context.beginPath();\n\n      if (offsets) {\n        var offset = offsets[anim];\n        var ix2 = index * 2;\n        context.rect(offset[ix2 + 0], offset[ix2 + 1], width, height);\n      } else {\n        context.rect(0, 0, width, height);\n      }\n\n      context.closePath();\n      context.fillShape(this);\n    }\n  }, {\n    key: \"_useBufferCanvas\",\n    value: function _useBufferCanvas() {\n      return _get(_getPrototypeOf(Sprite.prototype), \"_useBufferCanvas\", this).call(this, true);\n    }\n  }, {\n    key: \"_setInterval\",\n    value: function _setInterval() {\n      var that = this;\n      this.interval = setInterval(function () {\n        that._updateIndex();\n      }, 1000 / this.frameRate());\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      if (this.isRunning()) {\n        return;\n      }\n\n      var layer = this.getLayer();\n      this.anim.setLayers(layer);\n\n      this._setInterval();\n\n      this.anim.start();\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      this.anim.stop();\n      clearInterval(this.interval);\n    }\n  }, {\n    key: \"isRunning\",\n    value: function isRunning() {\n      return this.anim.isRunning();\n    }\n  }, {\n    key: \"_updateIndex\",\n    value: function _updateIndex() {\n      var index = this.frameIndex(),\n          animation = this.animation(),\n          animations = this.animations(),\n          anim = animations[animation],\n          len = anim.length / 4;\n\n      if (index < len - 1) {\n        this.frameIndex(index + 1);\n      } else {\n        this.frameIndex(0);\n      }\n    }\n  }]);\n\n  return Sprite;\n}(Shape);\nSprite.prototype.className = 'Sprite';\n\n_registerNode(Sprite);\n\nFactory.addGetterSetter(Sprite, 'animation');\nFactory.addGetterSetter(Sprite, 'animations');\nFactory.addGetterSetter(Sprite, 'frameOffsets');\nFactory.addGetterSetter(Sprite, 'image');\nFactory.addGetterSetter(Sprite, 'frameIndex', 0, getNumberValidator());\nFactory.addGetterSetter(Sprite, 'frameRate', 17, getNumberValidator());\nFactory.backCompat(Sprite, {\n  index: 'frameIndex',\n  getIndex: 'getFrameIndex',\n  setIndex: 'setFrameIndex'\n});","map":null,"metadata":{},"sourceType":"module"}