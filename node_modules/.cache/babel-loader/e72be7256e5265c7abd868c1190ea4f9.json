{"ast":null,"code":"import _classCallCheck from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\Development\\\\Encantos\\\\RandD\\\\Polotno\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport { glob } from './Global.js';\nimport { Util } from './Util.js';\n\nvar now = function () {\n  if (glob.performance && glob.performance.now) {\n    return function () {\n      return glob.performance.now();\n    };\n  }\n\n  return function () {\n    return new Date().getTime();\n  };\n}();\n\nexport var Animation = /*#__PURE__*/function () {\n  function Animation(func, layers) {\n    _classCallCheck(this, Animation);\n\n    this.id = Animation.animIdCounter++;\n    this.frame = {\n      time: 0,\n      timeDiff: 0,\n      lastTime: now(),\n      frameRate: 0\n    };\n    this.func = func;\n    this.setLayers(layers);\n  }\n\n  _createClass(Animation, [{\n    key: \"setLayers\",\n    value: function setLayers(layers) {\n      var lays = [];\n\n      if (!layers) {\n        lays = [];\n      } else if (layers.length > 0) {\n        lays = layers;\n      } else {\n        lays = [layers];\n      }\n\n      this.layers = lays;\n      return this;\n    }\n  }, {\n    key: \"getLayers\",\n    value: function getLayers() {\n      return this.layers;\n    }\n  }, {\n    key: \"addLayer\",\n    value: function addLayer(layer) {\n      var layers = this.layers,\n          len = layers.length,\n          n;\n\n      for (n = 0; n < len; n++) {\n        if (layers[n]._id === layer._id) {\n          return false;\n        }\n      }\n\n      this.layers.push(layer);\n      return true;\n    }\n  }, {\n    key: \"isRunning\",\n    value: function isRunning() {\n      var a = Animation,\n          animations = a.animations,\n          len = animations.length,\n          n;\n\n      for (n = 0; n < len; n++) {\n        if (animations[n].id === this.id) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      this.stop();\n      this.frame.timeDiff = 0;\n      this.frame.lastTime = now();\n\n      Animation._addAnimation(this);\n\n      return this;\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      Animation._removeAnimation(this);\n\n      return this;\n    }\n  }, {\n    key: \"_updateFrameObject\",\n    value: function _updateFrameObject(time) {\n      this.frame.timeDiff = time - this.frame.lastTime;\n      this.frame.lastTime = time;\n      this.frame.time += this.frame.timeDiff;\n      this.frame.frameRate = 1000 / this.frame.timeDiff;\n    }\n  }], [{\n    key: \"_addAnimation\",\n    value: function _addAnimation(anim) {\n      this.animations.push(anim);\n\n      this._handleAnimation();\n    }\n  }, {\n    key: \"_removeAnimation\",\n    value: function _removeAnimation(anim) {\n      var id = anim.id,\n          animations = this.animations,\n          len = animations.length,\n          n;\n\n      for (n = 0; n < len; n++) {\n        if (animations[n].id === id) {\n          this.animations.splice(n, 1);\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"_runFrames\",\n    value: function _runFrames() {\n      var layerHash = {},\n          animations = this.animations,\n          anim,\n          layers,\n          func,\n          n,\n          i,\n          layersLen,\n          layer,\n          key,\n          needRedraw;\n\n      for (n = 0; n < animations.length; n++) {\n        anim = animations[n];\n        layers = anim.layers;\n        func = anim.func;\n\n        anim._updateFrameObject(now());\n\n        layersLen = layers.length;\n\n        if (func) {\n          needRedraw = func.call(anim, anim.frame) !== false;\n        } else {\n          needRedraw = true;\n        }\n\n        if (!needRedraw) {\n          continue;\n        }\n\n        for (i = 0; i < layersLen; i++) {\n          layer = layers[i];\n\n          if (layer._id !== undefined) {\n            layerHash[layer._id] = layer;\n          }\n        }\n      }\n\n      for (key in layerHash) {\n        if (!layerHash.hasOwnProperty(key)) {\n          continue;\n        }\n\n        layerHash[key].batchDraw();\n      }\n    }\n  }, {\n    key: \"_animationLoop\",\n    value: function _animationLoop() {\n      var Anim = Animation;\n\n      if (Anim.animations.length) {\n        Anim._runFrames();\n\n        Util.requestAnimFrame(Anim._animationLoop);\n      } else {\n        Anim.animRunning = false;\n      }\n    }\n  }, {\n    key: \"_handleAnimation\",\n    value: function _handleAnimation() {\n      if (!this.animRunning) {\n        this.animRunning = true;\n        Util.requestAnimFrame(this._animationLoop);\n      }\n    }\n  }]);\n\n  return Animation;\n}();\nAnimation.animations = [];\nAnimation.animIdCounter = 0;\nAnimation.animRunning = false;","map":null,"metadata":{},"sourceType":"module"}