{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  return (__assign = Object.assign || function (e) {\n    for (var t, r = 1, n = arguments.length; r < n; r++) {\n      for (var o in t = arguments[r]) {\n        Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]);\n      }\n    }\n\n    return e;\n  }).apply(this, arguments);\n},\n    __rest = this && this.__rest || function (e, t) {\n  var r = {};\n\n  for (var n in e) {\n    Object.prototype.hasOwnProperty.call(e, n) && t.indexOf(n) < 0 && (r[n] = e[n]);\n  }\n\n  if (null != e && \"function\" == typeof Object.getOwnPropertySymbols) {\n    var o = 0;\n\n    for (n = Object.getOwnPropertySymbols(e); o < n.length; o++) {\n      t.indexOf(n[o]) < 0 && Object.prototype.propertyIsEnumerable.call(e, n[o]) && (r[n[o]] = e[n[o]]);\n    }\n  }\n\n  return r;\n},\n    __importDefault = this && this.__importDefault || function (e) {\n  return e && e.__esModule ? e : {\n    default: e\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: !0\n}), exports.registerTransformerAttrs = void 0;\n\nvar react_1 = __importDefault(require(\"react\")),\n    mobx_react_lite_1 = require(\"mobx-react-lite\"),\n    mobx_1 = require(\"mobx\"),\n    react_konva_1 = require(\"react-konva\"),\n    use_image_1 = __importDefault(require(\"use-image\")),\n    konva_1 = __importDefault(require(\"konva\")),\n    element_1 = __importDefault(require(\"./element\")),\n    use_transformer_snap_1 = require(\"./use-transformer-snap\"),\n    crop_1 = require(\"../utils/crop\"),\n    DEFAULT_TRANSFORMER_ATTRIBUTES = {\n  enabledAnchors: [\"top-left\", \"top-center\", \"top-right\", \"middle-left\", \"bottom-left\", \"bottom-right\", \"bottom-center\", \"middle-right\"],\n  rotateEnabled: !0,\n  rotationSnaps: [0, 45, 90, 135, 180, 225, 270, 315],\n  ignoreStroke: !0,\n  anchorStrokeWidth: 2,\n  borderStrokeWidth: 2\n},\n    transformerAttributes = {\n  text: {\n    enabledAnchors: [\"top-left\", \"top-right\", \"middle-left\", \"bottom-left\", \"bottom-right\", \"middle-right\"]\n  },\n  svg: {\n    enabledAnchors: [\"top-left\", \"top-right\", \"bottom-left\", \"bottom-right\"]\n  },\n  many: {\n    enabledAnchors: [\"top-left\", \"top-right\", \"bottom-left\", \"bottom-right\"]\n  }\n};\n\nfunction registerTransformerAttrs(e, t) {\n  transformerAttributes[e] = transformerAttributes[e] || t, Object.assign(transformerAttributes[e], t);\n}\n\nexports.registerTransformerAttrs = registerTransformerAttrs;\n\nvar Background = function Background(e) {\n  return react_1.default.createElement(react_konva_1.Rect, __assign({}, e, {\n    fill: \"#e8e8e8\"\n  }));\n},\n    PageBackground = function PageBackground(e) {\n  var t = e.background,\n      r = __rest(e, [\"background\"]),\n      n = t.indexOf(\"http\") >= 0 || t.indexOf(\".png\") >= 0 || t.indexOf(\".jpg\") >= 0,\n      o = use_image_1.default(n ? t : \"\", \"Anonymous\")[0],\n      a = n ? react_konva_1.Image : react_konva_1.Rect,\n      i = n && o ? crop_1.getCrop(o, {\n    width: e.width,\n    height: e.height\n  }, \"center-middle\") : {};\n\n  return react_1.default.createElement(react_1.default.Fragment, null, react_1.default.createElement(react_konva_1.Rect, {\n    x: -1,\n    y: -1,\n    width: e.width + 2,\n    height: e.height + 2,\n    stroke: \"lightgrey\",\n    strokeWidth: 2,\n    listening: !1\n  }), react_1.default.createElement(a, __assign({\n    image: o\n  }, r, {\n    fill: n ? \"white\" : t\n  }, i)));\n},\n    Selection = mobx_react_lite_1.observer(function (e) {\n  var t = e.selection;\n  return t.visible ? react_1.default.createElement(react_konva_1.Rect, {\n    name: \"selection\",\n    x: Math.min(t.x1, t.x2),\n    y: Math.min(t.y1, t.y2),\n    width: Math.abs(t.x1 - t.x2),\n    height: Math.abs(t.y1 - t.y2),\n    fill: \"rgba(0, 161, 255, 0.3)\"\n  }) : null;\n}),\n    Elements = mobx_react_lite_1.observer(function (e) {\n  var t = e.elements,\n      r = e.store;\n  return react_1.default.createElement(react_1.default.Fragment, null, t.map(function (e) {\n    return react_1.default.createElement(element_1.default, {\n      key: e.id,\n      store: r,\n      element: e,\n      onClick: function onClick() {\n        console.warn(\"Polotno warning: onClick callback is deprecated. Just stop using it. Polotno will do selection automatically.\");\n      }\n    });\n  }));\n});\n\nexports.default = mobx_react_lite_1.observer(function (e) {\n  var t = e.store,\n      r = e.page,\n      n = e.xPadding,\n      o = e.yPadding,\n      a = e.width,\n      i = e.height,\n      l = react_1.default.useRef(null),\n      c = react_1.default.useRef(null),\n      s = react_1.default.useRef(null),\n      u = t.selectedElements.find(function (e) {\n    return e._cropModeEnabled;\n  }),\n      d = t.selectedElements.filter(function (e) {\n    return e.locked;\n  }).length > 0;\n  react_1.default.useEffect(function () {\n    var e, r;\n\n    if (l.current) {\n      var n = l.current.getStage(),\n          o = t.selectedElements.map(function (e) {\n        return e._cropModeEnabled ? null : n.findOne(\"#\" + e.id);\n      }).filter(function (e) {\n        return e;\n      }),\n          a = 1 === t.selectedElements.length && (null === (e = t.selectedElements[0]) || void 0 === e ? void 0 : e.type) || \"many\";\n      d ? (l.current.enabledAnchors([]), l.current.rotateEnabled(!1)) : transformerAttributes[a] ? (l.current.setAttrs(__assign(__assign({}, DEFAULT_TRANSFORMER_ATTRIBUTES), transformerAttributes[a])), \"svg\" !== a || t.selectedElements[0].keepRatio || l.current.setAttrs({\n        enabledAnchors: DEFAULT_TRANSFORMER_ATTRIBUTES.enabledAnchors\n      })) : l.current.setAttrs(DEFAULT_TRANSFORMER_ATTRIBUTES), l.current.nodes(o), null === (r = l.current.getLayer()) || void 0 === r || r.batchDraw();\n    }\n  }, [t.selectedElements, u, d]);\n\n  var f = mobx_react_lite_1.useLocalObservable(function () {\n    return {\n      visible: !1,\n      x1: 0,\n      y1: 0,\n      x2: 0,\n      y2: 0\n    };\n  }),\n      _ = react_1.default.useRef(!1),\n      m = mobx_1.action(function (e) {\n    var n;\n    _.current = !1, t.activePage !== r && r.select();\n    var o = e.target.findAncestor(\".elements-container\"),\n        a = e.target.findAncestor(\"Transformer\"),\n        i = e.target.findAncestor(\".page-abs-container\");\n\n    if (!(o || a || i)) {\n      var l = null === (n = e.target.getStage()) || void 0 === n ? void 0 : n.getPointerPosition();\n      l && (f.visible = !0, f.x1 = l.x, f.y1 = l.y, f.x2 = l.x, f.y2 = l.y);\n    }\n  });\n\n  react_1.default.useEffect(function () {\n    var e = mobx_1.action(function (e) {\n      var t, r;\n\n      if (f.visible) {\n        null === (t = c.current) || void 0 === t || t.setPointersPositions(e);\n        var n = (null === (r = c.current) || void 0 === r ? void 0 : r.getPointerPosition()) || {\n          x: f.x2,\n          y: f.y2\n        };\n        f.x2 = n.x, f.y2 = n.y;\n      }\n    }),\n        r = mobx_1.action(function () {\n      if (f.visible && c.current) {\n        var e = c.current.findOne(\".selection\"),\n            r = e ? e.getClientRect() : {\n          width: 0,\n          height: 0,\n          x: 0,\n          y: 0\n        };\n\n        if (r.width && r.height) {\n          var n = [];\n          c.current.find(\".element\").forEach(function (e) {\n            var o = e.getClientRect(),\n                a = t.getElementById(e.id()),\n                i = null == a ? void 0 : a.locked;\n            konva_1.default.Util.haveIntersection(r, o) && !i && n.push(e.id());\n          }), t.selectElements(n);\n        }\n\n        f.visible = !1, _.current = !0;\n      }\n    });\n    return window.addEventListener(\"mousemove\", e), window.addEventListener(\"touchmove\", e), window.addEventListener(\"mouseup\", r), window.addEventListener(\"touchend\", r), function () {\n      window.removeEventListener(\"mousemove\", e), window.removeEventListener(\"touchmove\", e), window.removeEventListener(\"mouseup\", r), window.removeEventListener(\"touchend\", r);\n    };\n  }, []);\n\n  var g = function g(e) {\n    if (!_.current) {\n      var r = e.evt.ctrlKey || e.evt.metaKey || e.evt.shiftKey,\n          n = e.target.findAncestor(\".elements-container\"),\n          o = e.target.findAncestor(\".page-abs-container\"),\n          a = e.target.findAncestor(\"Transformer\");\n      if (!(r || n || a || o)) t.selectElements([]);else {\n        var i = e.target.findAncestor(\".element\", !0),\n            l = t.selectedElementsIds.indexOf(null == i ? void 0 : i.id()) >= 0;\n        i && r && !l && t.selectElements(t.selectedElementsIds.concat([i.id()])), i && r && l && t.selectElements(t.selectedElementsIds.filter(function (e) {\n          return e !== i.id();\n        })), i && !r && t.selectElements([i.id()]);\n      }\n    }\n  };\n\n  return use_transformer_snap_1.useSnap(l), react_1.default.createElement(\"div\", {\n    ref: s,\n    onDragOver: function onDragOver(e) {\n      return e.preventDefault();\n    },\n    onDrop: function onDrop(e) {\n      var t;\n      e.preventDefault(), c.current.setPointersPositions(e);\n      var r = null === (t = c.current) || void 0 === t ? void 0 : t.findOne(\".elements-container\"),\n          n = r.getAbsoluteTransform().copy();\n      n.invert();\n      var o = r.getStage().getPointerPosition(),\n          a = n.point(o);\n      window.__polotnoDrop && window.__polotnoDrop(a);\n    }\n  }, react_1.default.createElement(react_konva_1.Stage, {\n    ref: c,\n    width: a,\n    height: i,\n    onClick: g,\n    onTap: g,\n    onMouseDown: m,\n    onTouchStart: m,\n    onDragStart: function onDragStart(e) {\n      if (e.target.hasName(\"element\")) {\n        var r = e.target.id();\n        !(t.selectedElementsIds.indexOf(r) >= 0) && r && t.selectElements([r]);\n      }\n    },\n    pageId: r.id,\n    style: {\n      position: \"relative\"\n    }\n  }, react_1.default.createElement(react_konva_1.Layer, null, react_1.default.createElement(Background, {\n    width: a,\n    height: i\n  }), react_1.default.createElement(react_konva_1.Group, {\n    x: n,\n    y: o,\n    scaleX: t.scale,\n    scaleY: t.scale,\n    name: \"page-container\"\n  }, react_1.default.createElement(PageBackground, {\n    width: t.width,\n    height: t.height,\n    background: r.background,\n    shadowBlur: 10,\n    shadowColor: \"lightgrey\",\n    name: \"page-background\"\n  }), react_1.default.createElement(react_konva_1.Group, {\n    clipX: 0,\n    clipY: 0,\n    clipWidth: t.width,\n    clipHeight: t.height,\n    name: \"elements-container\"\n  }, react_1.default.createElement(Elements, {\n    elements: r.children,\n    store: t\n  }))), react_1.default.createElement(react_konva_1.Group, {\n    x: n,\n    y: o,\n    scaleX: t.scale,\n    scaleY: t.scale,\n    name: \"page-abs-container\"\n  }, react_1.default.createElement(react_konva_1.Transformer, {\n    ref: l,\n    boundBoxFunc: function boundBoxFunc(e, t) {\n      var r = t.width < 1 || t.height < 1,\n          n = e.width < 1 || e.height < 1;\n      return r && !n ? e : t;\n    }\n  })), react_1.default.createElement(Selection, {\n    selection: f\n  }), t._showCredit && react_1.default.createElement(react_konva_1.Text, {\n    text: \"Powered by polotno.dev\",\n    fontSize: 14,\n    fill: \"rgba(0,0,0,0.6)\",\n    x: a - 156,\n    y: i - 18,\n    onMouseEnter: function onMouseEnter(e) {\n      e.target.getStage().container().style.cursor = \"pointer\";\n    },\n    onMouseLeave: function onMouseLeave(e) {\n      e.target.getStage().container().style.cursor = \"\";\n    },\n    onTouchStart: function onTouchStart(e) {\n      e.cancelBubble = !0;\n    },\n    onMouseDown: function onMouseDown(e) {\n      e.cancelBubble = !0;\n    },\n    onClick: function onClick() {\n      window.open(\"https://polotno.dev\");\n    },\n    onTap: function onTap() {\n      window.open(\"https://polotno.dev\");\n    }\n  }))));\n});","map":null,"metadata":{},"sourceType":"script"}