"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,a){function i(t){try{c(o.next(t))}catch(t){a(t)}}function l(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,l)}c((o=o.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},__rest=this&&this.__rest||function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextPanel=void 0;var react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),core_1=require("@blueprintjs/core"),toBase64=function(t){return new Promise((function(e,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){return e(o.result)},o.onerror=function(t){return n(t)}}))},FontItem=mobx_react_lite_1.observer((function(t){var e=t.onSelect,n=t.onRemove,o=t.font;return react_1.default.createElement("div",{style:{height:"100px",cursor:"pointer",boxShadow:"0 0 5px rgba(16, 22, 26, 0.3)",borderRadius:"5px",backgroundColor:"rgba(0, 0, 0, 0.4)",position:"relative",fontFamily:o.fontFamily,fontSize:25,display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column",textAlign:"center",color:"white",marginBottom:"10px"},onClick:e},o.fontFamily," text",react_1.default.createElement(core_1.Button,{style:{position:"absolute",right:0,bottom:0},minimal:!0,icon:"trash",onClick:function(t){t.stopPropagation(),n()}}))})),DragButton=function(t){var e=t.onSelect,n=__rest(t,["onSelect"]);return react_1.default.createElement(core_1.Button,__assign({},n,{draggable:!0,onClick:function(){return e()},onDragStart:function(){window.__polotnoDrop=function(t){var n=t.x,o=t.y;e({x:n,y:o})}},onDragEnd:function(t){window.__polotnoDrop=null}}))};exports.TextPanel=mobx_react_lite_1.observer((function(t){var e=t.store;react_1.default.useEffect((function(){e.loadFont("Amatic SC"),e.loadFont("Roboto"),e.loadFont("Rubik Mono One"),e.loadFont("Press Start 2P")}),[]);var n=function(t){var n,o=t.width||e.width/2,r=((null==t?void 0:t.x)||e.width/2)-o/2,a=((null==t?void 0:t.y)||e.height/2)-t.fontSize/2,i=null===(n=e.activePage)||void 0===n?void 0:n.addElement(__assign(__assign({type:"text",fontFamily:"Roboto"},t),{x:r,y:a,width:o}));null==i||i.toggleEditMode(!0)};return react_1.default.useEffect((function(){e.fonts.forEach((function(t){return e.loadFont(t.fontFamily)}))}),[e.fonts]),react_1.default.createElement("div",{style:{height:"100%"}},react_1.default.createElement(core_1.Tabs,{large:!0},react_1.default.createElement(core_1.Tab,{id:"text",panel:react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"25px",marginBottom:"20px",fontFamily:"Roboto"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:125,text:"HEADER TEXT",fontFamily:"Roboto"}))}},"Create HEADER"),react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"18px",marginBottom:"20px"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:90,text:"SUB HEADER TEXT"}))}},"Create SUB HEADER"),react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"14px",marginBottom:"20px"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:80,text:"Body text"}))}},"Create body text"),react_1.default.createElement("h3",null,"Styled text"),react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"20px",marginBottom:"20px",fontFamily:"Amatic SC"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:80,text:"Cool curved text",fontFamily:"Amatic SC"}))}},"Cool curved text"),react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"40px",marginBottom:"20px",fontFamily:"Rubik Mono One",textAlign:"center"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:85,width:650,text:"GIGANTIC TEXT",fontFamily:"Rubik Mono One"}))}},"GIGANTIC TEXT"),react_1.default.createElement(DragButton,{style:{width:"100%",fontSize:"30px",marginBottom:"20px",fontFamily:'"Press Start 2P"',textAlign:"center"},minimal:!0,onSelect:function(t){n(__assign(__assign({},t),{fontSize:50,text:"JUST DO IT!",fontFamily:"Press Start 2P"}))}},"JUST DO IT!"))},"Text"),react_1.default.createElement(core_1.Tab,{id:"font",panel:react_1.default.createElement("div",{style:{display:"flex",flexDirection:"column",height:"calc(100% - 50px)"}},react_1.default.createElement("label",{htmlFor:"polotno-font-upload"},react_1.default.createElement(core_1.Button,{icon:"upload",style:{width:"100%"},onClick:function(){var t;null===(t=document.querySelector("#polotno-font-upload"))||void 0===t||t.click()}},"Upload"),react_1.default.createElement("input",{type:"file",accept:".ttf, .otf, .woff, .woff2, .eot",id:"polotno-font-upload",style:{display:"none"},onChange:function(t){return __awaiter(void 0,void 0,void 0,(function(){var n,o,r,a,i,l;return __generator(this,(function(c){switch(c.label){case 0:n=t.target,o=0,r=n.files,c.label=1;case 1:return o<r.length?(a=r[o],[4,toBase64(a)]):[3,4];case 2:i=c.sent(),l=a.name.split(".")[0],e.addFont({fontFamily:l,url:i}),c.label=3;case 3:return o++,[3,1];case 4:return n.value=null,[2]}}))}))}})),react_1.default.createElement("div",{style:{paddingTop:"20px",overflow:"auto",height:"100%"}},e.fonts.map((function(t,o){return react_1.default.createElement(FontItem,{font:t,key:o,onSelect:function(){n({fontSize:80,text:"Cool curved text",fontFamily:t.fontFamily})},onRemove:function(){e.removeFont(t.fontFamily)}})}))))},"My Fonts")))}));