"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Workspace=void 0;var react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),page_1=__importDefault(require("./page")),hotkeys_1=require("./hotkeys"),MIN_PADDING=20,ZERO_SIZE_WARNING="Polotno warning: <Workspace /> component can not automatically detect its size.\nWidth or height of parent elements is equal 0.\nPlease make sure it has non-zero size. You may need to adjust it with your styles. <Workspace /> will automatically fit into parent container.\nFor simpler debugging here is the log of the parent element:",useAutoScroll=function(e,t,r,a,n){var o=react_1.default.useRef({width:t,height:r}),i=react_1.default.useRef({top:0,left:0});react_1.default.useEffect((function(){var t=e.current,r=function(){i.current={top:t.scrollTop,left:t.scrollLeft}};return t.addEventListener("scroll",r),function(){t.removeEventListener("scroll",r)}}),[]),react_1.default.useLayoutEffect((function(){if(e.current){var a=e.current,n=(i.current.left+a.offsetWidth/2)/o.current.width,l=(i.current.top+a.offsetHeight/2)/o.current.height;a.scrollLeft=n*t-a.offsetWidth/2,a.scrollTop=l*r-a.offsetHeight/2,o.current={width:t,height:r}}}),[a,t,r])};exports.Workspace=mobx_react_lite_1.observer((function(e){var t=e.store,r=react_1.default.useState({width:100,height:100}),a=r[0],n=r[1],o=react_1.default.useRef(null),i=react_1.default.useRef(null),l=function(){if(null!==o.current){var e=o.current.getBoundingClientRect();0!==e.width&&0!==e.height||(console.warn(ZERO_SIZE_WARNING),console.log(o.current)),n({width:e.width,height:e.height});var r=(e.width-2*MIN_PADDING)/t.width,a=(e.height-2*MIN_PADDING)/t.height,i=Math.min(r,a);t.setScale(i),t._setScaleToFit(i)}};react_1.default.useEffect(l,[t.width,t.height]),react_1.default.useEffect((function(){return window.addEventListener("resize",l),function(){return window.removeEventListener("resize",l)}}),[]);var c=Math.max(MIN_PADDING,(a.width-t.width*t.scale)/2),u=Math.max(MIN_PADDING,(a.height-t.height*t.scale)/2);react_1.default.useEffect((function(){var e=function(e){hotkeys_1.handleHotkey(e,t)};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[]);return useAutoScroll(i,t.width*t.scale+2*c,t.height*t.scale+2*u,t.scale,t),react_1.default.createElement("div",{ref:o,style:{width:"100%",height:"100%",position:"relative",outline:"none"},tabIndex:0},react_1.default.createElement("div",{ref:i,onScroll:function(e){var r=e.currentTarget.childNodes[0].childNodes[0].offsetHeight,a=e.currentTarget.scrollTop,n=Math.floor((a+100)/r),o=t.pages[n];o&&o.select()},style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"}},t.pages.map((function(e){return react_1.default.createElement(page_1.default,{key:e.id,page:e,xPadding:c,yPadding:u,width:t.width*t.scale+2*c,height:t.height*t.scale+2*u,store:t})})),0===t.pages.length&&react_1.default.createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"}},react_1.default.createElement("p",null,"There are no pages yet... "),react_1.default.createElement("button",{onClick:function(){t.addPage()}},"Add page"))))})),exports.default=exports.Workspace;