"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,s)}a((o=o.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,o,n,i,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(n=l.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){l.label=i[1];break}if(6===i[0]&&l.label<n[1]){l.label=n[1],n=i;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(i);break}n[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceColors=exports.fixSize=exports.getSvgSize=exports.svgToURL=exports.getColors=exports.urlToString=exports.urlToBase64=void 0;var konva_1=__importDefault(require("konva"));function isInsideDef(e){for(;e.parentNode;){if("defs"===e.nodeName)return!0;e=e.parentNode}return!1}function getElementColors(e){var t={fill:"",stroke:""};return e.getAttribute("fill")&&"none"!==e.getAttribute("fill")&&(t.fill=e.getAttribute("fill")),!t.fill&&e.style.fill&&"none"!==e.style.fill&&(t.fill=e.style.fill),e.getAttribute("stroke")&&(t.stroke=e.getAttribute("stroke")),!t.stroke&&e.style.stroke&&(t.stroke=e.style.stroke),t.stroke||t.fill||(t.fill="black"),t}var SVG_SHAPES=["path","rect","circle"];function getAllElementsWithColor(e){for(var t=[],r=e.getElementsByTagName("*"),o=0,n=r.length;o<n;o++){var i=r[o];isInsideDef(i)||(null!==i.getAttribute("fill")&&t.push(i),(null!==i.getAttribute("stroke")||i.style&&i.style.fill||SVG_SHAPES.indexOf(i.nodeName)>=0)&&t.push(i))}return t}function urlToBase64(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,fetch(e)];case 1:return[4,t.sent().text()];case 2:return[2,svgToURL(t.sent())]}}))}))}function urlToString(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,fetch(e,{mode:"cors"})];case 1:return[4,t.sent().text()];case 2:return[2,t.sent()]}}))}))}function getColors(e){var t=getAllElementsWithColor((new DOMParser).parseFromString(e,"image/svg+xml")),r=[];return t.forEach((function(e){var t=getElementColors(e);[t.fill,t.stroke].forEach((function(e){e&&(konva_1.default.Util.colorToRGBA(e)&&-1===r.indexOf(e)&&r.push(e))}))})),r}function svgToURL(e){return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e)))}function getSvgSize(e){return __awaiter(this,void 0,void 0,(function(){var t,r,o,n,i,l,s;return __generator(this,(function(a){switch(a.label){case 0:return[4,urlToString(e)];case 1:return t=a.sent(),r=new DOMParser,o=r.parseFromString(t,"image/svg+xml"),n=o.documentElement.getAttribute("viewBox"),i=(null==n?void 0:n.split(" "))||[],i[0],i[1],l=i[2],s=i[3],[2,{width:parseFloat(l),height:parseFloat(s)}]}}))}))}function fixSize(e){var t=(new DOMParser).parseFromString(e,"image/svg+xml"),r=t.documentElement.getAttribute("viewBox"),o=(null==r?void 0:r.split(" "))||[],n=(o[0],o[1],o[2]),i=o[3];return t.documentElement.getAttribute("width")||t.documentElement.setAttribute("width",n+"px"),t.documentElement.getAttribute("height")||t.documentElement.setAttribute("height",i+"px"),(new XMLSerializer).serializeToString(t)}exports.urlToBase64=urlToBase64,exports.urlToString=urlToString,exports.getColors=getColors,exports.svgToURL=svgToURL,exports.getSvgSize=getSvgSize,exports.fixSize=fixSize;var sameColors=function(e,t){return!(!t||!t)&&(e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a)};function replaceColors(e,t){var r=(new DOMParser).parseFromString(e,"image/svg+xml"),o=getAllElementsWithColor(r),n=Array.from(t.keys());return o.forEach((function(e){var r=getElementColors(e);[{prop:"fill",color:r.fill},{prop:"stroke",color:r.stroke}].forEach((function(r){var o=r.prop,i=r.color,l=n.find((function(e){return sameColors(konva_1.default.Util.colorToRGBA(e),konva_1.default.Util.colorToRGBA(i))}));l&&(e.style[o]=t.get(l))}))})),svgToURL((new XMLSerializer).serializeToString(r))}exports.replaceColors=replaceColors;