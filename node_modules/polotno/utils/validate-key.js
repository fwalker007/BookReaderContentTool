"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateKey=exports.getKey=void 0;var base_url_1=require("./base-url"),API_KEY="",getKey=function(){return API_KEY||""};exports.getKey=getKey;var ATTEMPTS=5,TIMEOUT=3e3,NO_KEY_MESSAGE="Polotno API is initialized without API key. It may lead to unexpected behavior and stop working. Please create API key here: https://polotno.dev/cabinet",NO_VALID_MESSAGE="Polotno API key is not valid. Please get new API key here: https://polotno.dev/cabinet",ERROR_MESSAGE="Can not validate Polotno API key. Please report to anton@polotno.dev immediately.",NOT_PAID_MESSAGE="%cPolotno Free Version. Development or non-commercial usage only. https://polotno.dev/",BAD_DOMAIN_MESSAGE='Polotno error! Current domain is not allowed. It may lead to unexpected behavior and stop working. Please add "'+location.origin+'" here: https://polotno.dev/cabinet';function validateKey(e){return __awaiter(this,void 0,void 0,(function(){var t,n,o;return __generator(this,(function(r){switch(r.label){case 0:API_KEY=e,t=0,r.label=1;case 1:if(!(t<ATTEMPTS))return[3,10];r.label=2;case 2:return r.trys.push([2,7,,9]),[4,fetch(base_url_1.API+"/validate-key",{method:"POST",body:JSON.stringify({key:e,site:location.href})})];case 3:return n=r.sent(),e?200===n.status?[3,5]:[4,new Promise((function(e){return setTimeout(e,TIMEOUT)}))]:(console.warn(NO_KEY_MESSAGE),[2,!1]);case 4:return r.sent(),[3,9];case 5:return[4,n.json()];case 6:return(o=r.sent()).is_valid||console.warn(NO_VALID_MESSAGE),o.is_paid||console.log(NOT_PAID_MESSAGE,"background: rgb(0, 161, 255); color: white; padding: 5px; margin: 5px;"),o.is_domain_valid||console.warn(BAD_DOMAIN_MESSAGE),[2,o.is_paid||!1];case 7:return r.sent(),[4,new Promise((function(e){return setTimeout(e,TIMEOUT)}))];case 8:return r.sent(),[3,9];case 9:return t++,[3,1];case 10:return console.error(ERROR_MESSAGE),[2,!0]}}))}))}exports.validateKey=validateKey;