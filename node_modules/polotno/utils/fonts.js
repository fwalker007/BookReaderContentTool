"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,s){function a(t){try{l(o.next(t))}catch(t){s(t)}}function i(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,i)}l((o=o.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.injectCustomFont=exports.injectGoogleFont=exports.loadFont=exports.getFontsList=exports.setGoogleFonts=void 0;var GOOGLE_FONTS=["Roboto","Amatic SC","Press Start 2P","Marck Script","Rubik Mono One"];function setGoogleFonts(t){GOOGLE_FONTS=t}function getFontsList(){return GOOGLE_FONTS}exports.setGoogleFonts=setGoogleFonts,exports.getFontsList=getFontsList;var TEXT_TEXT="Some test text;?#D-ПРИВЕТ!",canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");function measureArial(){return measureFont("Arial")}function measureFont(t){return ctx.font="normal 40px '"+t+"', Arial",ctx.measureText(TEXT_TEXT).width}var MAX_ATTEMPTS=100,loadedFonts={Arial:!0};function loadFont(t){var e;return __awaiter(this,void 0,void 0,(function(){var n,o,r,s,a;return __generator(this,(function(i){switch(i.label){case 0:return loadedFonts[t]?[2]:(n=!!(null===(e=document.fonts)||void 0===e?void 0:e.load),o=measureArial(),n?[4,document.fonts.load("16px '"+t+"'")]:[3,2]);case 1:if(i.sent(),a=measureFont(t),o!==a)return loadedFonts[t]=!0,[2];i.label=2;case 2:r=measureFont(t),s=0,i.label=3;case 3:return s<MAX_ATTEMPTS?(a=measureFont(t),a!==r||a!==o?(loadedFonts[t]=!0,[2]):[4,new Promise((function(t){return setTimeout(t,60)}))]):[3,6];case 4:i.sent(),i.label=5;case 5:return s++,[3,3];case 6:return[2]}}))}))}exports.loadFont=loadFont;var registeredGoogleFonts={};function injectGoogleFont(t){if(!registeredGoogleFonts[t]){var e="https://fonts.googleapis.com/css?family="+t.replace(/ /g,"+"),n=document.createElement("link");n.type="text/css",n.href=e,n.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(n),registeredGoogleFonts[t]=!0}}exports.injectGoogleFont=injectGoogleFont;var registeredCustomFonts={};function injectCustomFont(t){var e=t.fontFamily;if(!registeredCustomFonts[e]&&(t.url||t.styles)){var n=document.createElement("style");n.type="text/css";var o=t.styles||(t.url?[{src:'url("'+t.url+'")'}]:[]),r="";o.forEach((function(t){r+="\n      @font-face {\n        font-family: '"+e+"';\n        src: "+t.src+";\n        font-style: "+(t.fontStyle||"normal")+";\n        font-weight: "+(t.fontWeight||"normal")+";\n      }\n    "})),n.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(n),registeredCustomFonts[t.fontFamily]=!0}}exports.injectCustomFont=injectCustomFont;